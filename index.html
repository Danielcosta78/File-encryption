<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    	<meta name='description' content='Encrypt and decrypt files, Encryption.'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    	<script type='text/javascript' src='//pl25175453.profitablecpmrate.com/d1/8c/fa/d18cfa91c05be5cfbcb07fa7efcecc28.js'></script>
    <style>
        body {
            background-color: #f4f4f4;
            color: #333;
        }
        header, nav, section, article, footer {
            margin: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .btn {
            margin: 1px; /* Adiciona espaço ao redor de cada botão */
            padding: 1px 1px; /* Adiciona espaço dentro de cada botão */
        }
        button {

            margin-right: 10px; /* Espaço entre o botão e os outros itens */

            padding: 10px 20px;

            background-color: #2b58de;

            color: white;

            border: none;

            border-radius: 5px;

            cursor: pointer;

            transition: background-color 0.3s ease;

        }
        button:focus {

            outline: 3px solid #1d44b8;

            box-shadow: 0 0 10px #1d44b8;

            background-color: #1d44b8;

        }
    </style>
</head>
<body>
    <header class="container">
        <h1>File encryption</h1>
        <h2>Encrypt and Decrypt Files</h12>
    </header>

    <nav class="container">

        <ul class="nav nav-pills">

            <button class="btn"><a class="nav-link active" href="#home">Home</a></button>       
            
            <button class="btn"><a class="nav-link active" href="#crip">File encryption</a></button>
          
            <button class="btn"><a class="nav-link active" href="#info">Info</a></button>
          
            <button class="btn"><a class="nav-link active" href="#Contribute">Contribute</a></button>

        </ul>

    </nav>

    <section class="container" id="home">
            <h2>Introduction</h2>
            <p>Encrypt and decrypt files with password.</p>
    </section>

    <footer class="container">
        <p>Encryption in the code, we do not store any files.</p>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
		<div class=container>
			<div class="divTablefullwidth">
				<div class="divTableBody">
					<div class="divTableRow">
						<div class="divTableCell" style="float:">
							<h1>Encrypt and Decrypt Files</h1>
							<h4>Choose whether to encrypt or decrypt.</h4>
					        <div class="divTableCell" style="float:">
					    	<p>
							<button id="btnRefresh" onClick="javascript:location.reload();">Refresh</button>
							<button id="btnDivEncrypt" onClick="javascript:switchdiv('encrypt');">Encrypt</button>
							<button id="btnDivDecrypt" onClick="javascript:switchdiv('decrypt');">Decrypt</button>
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<hr>
		<div class=container id="crip">
				<script type="text/javascript">
	atOptions = {
		'key' : '4207259791ba034457cbb5846b749de3',
		'format' : 'iframe',
		'height' : 50,
		'width' : 320,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/4207259791ba034457cbb5846b749de3/invoke.js"></script>
		</div>

		<div class="container" id=divEncryptfile>
			<h2>Encrypt a File</h2>
			<p>To encrypt a file, enter a password and drop the file to be encrypted into the dropzone below.  The file will then be encrypted using the password, then you'll be given an opportunity to save the encrypted file to your system.</p>
			<p><span style="color: red;">Password must be longer than 8 characters and match.</span><p>

			
			<div class="divTable">
				<div class="divTableBody">
					<div class="divTableRow">
						<div class="divTableCell">Password</div>
						<div class="divTableCell"><input id=txtEncpassphrase type=password size=20 onkeyup=javascript:encvalidate(); value=''></div>
					</div>
					<div class="divTableRow">
						<div class="divTableCell">Password (retype)</div>
						<div class="divTableCell"><input id=txtEncpassphraseretype type=password size=20 onkeyup=javascript:encvalidate(); value=''></div>
						<div class="divTableCell"><span class=greenspan id=spnCheckretype></span></div>
					</div>
				</div>
			</div>

			<p> </p>

			<div>
				<div class=dropzone id="encdropzone" ondrop="drop_handler(event);" ondragover="dragover_handler(event);" ondragend="dragend_handler(event);">
					<p>Click <a onclick=javascript:encfileElem.click();><span style="color: red;">&#128193;here</span></a> to select file.</p>
					<p><span id=spnencfilename></span></p>
				</div>
				<input type="file" id="encfileElem" style="display:none" onchange="selectfile(this.files)">
			</div>

			<p> </p>

			<div class="divTable">
				<div class="divTableBody">
					<div class="divTableRow">
						<div class="divTableCell"><button id=btnEncrypt onclick=javascript:encryptfile(); disabled>Encrypt File</button></div>
						<div class="divTableCell"><span id=spnEncstatus></span></div>
					</div>
				</div>
			</div>

			<p> </p>

			<div>
				<a id=aEncsavefile hidden><button>Save Encrypted File</button></a>
			</div>
		
			<p> </p>
		</div>

		<div class="container" id=divDecryptfile>
			<h2>Decrypt a File</h2>
			<p>Decrypt a file using the password that was previously used to encrypt the file.  After the file is decrypted, you'll be given an opportunity to save the decrypted file to your system.</p>

			<div class="divTable">
				<div class="divTableBody">
					<div class="divTableRow">
						<div class="divTableCell">Password</div>
						<div class="divTableCell"><input id=txtDecpassphrase type=password size=20 onkeyup=javascript:decvalidate(); value=''></div>
					</div>
				</div>
			</div>

			<p> </p>

			<div>
					<div class=dropzone  id="decdropzone" ondrop="drop_handler(event);" ondragover="dragover_handler(event);" ondragend="dragend_handler(event);">
						<p>Click <a role=button onclick=javascript:decfileElem.click();><span style="color: red;">&#128193;here</span></a> to select file.</p>
						<p><span id=spndecfilename></span></p>
					</div>
					<input type="file" id="decfileElem" style="display:none" onchange="selectfile(this.files)">
			</div>

			<p> </p>

			<div class="divTable">
				<div class="divTableBody">
					<div class="divTableRow">
						<div class="divTableCell"><button id=btnDecrypt onclick=javascript:decryptfile(); disabled>Decrypt File</button></div>
						<div class="divTableCell"><span id=spnDecstatus></span></div>
					</div>
				</div>
			</div>

			<p> </p>

			<div>
				<a id=aDecsavefile hidden><button>Save Decrypted File</button></a>
			</div>
		
			<p> </p>
		</div>

		<div class="container" id="info">
			<hr>
				<script type="text/javascript">
	atOptions = {
		'key' : '60c3d76f9b24dbc4765cb226566addc5',
		'format' : 'iframe',
		'height' : 250,
		'width' : 300,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/60c3d76f9b24dbc4765cb226566addc5/invoke.js"></script>
			<h3>Usage</h3>
			<p>
			Use this web page to encrypt a file using a password, then use the same password later to decrypt the file.  <span style="color: red;">IMPORTANT:</span>  The same password that was used to encrypt the file must be used to decrypt the file later. If you loose or forget the password, it cannot be recovered!
			</p>

			<h3>Cryptography</h3>
			<p> 
			Files are encrypted using <span style="color: red;">AES-CBC 256-bit symmetric encryption.  The encryption key is derived from the password and a random salt using PBKDF2 derivation with 10000 iterations of SHA256 hashing.</span> All cryptography code is present on this page, the files to encrypt and decrypt do not leave your device. You should remove the <span style="color: red;">.enc.dec</span> file extension after decryption.
			</p>
			<body>
				
				<header class="container"  id="Contribute">

    <p>Help us make a <a href="https://www.paypal.com/donate/?hosted_button_id=N8A6EWXCNPB78" target="_blank"><span style="color: red;">donate.</span></a></p>
				
				</header>
				
				<script async="async" data-cfasync="false" src="//pl25175790.profitablecpmrate.com/2c2e66f5830350158fa35158919efd24/invoke.js"></script>
<div id="container-2c2e66f5830350158fa35158919efd24"></div>
				<p class="version">v0.1.2</p>
			
			
		</div>
		<BR>
     <section>
     Download our app <a href="https://drive.google.com/file/d/14xL9ZVORgD7eZlBpUMAYAsfW6-TUaDJr/view?usp=drivesdk" target="_blank">here</a>.</p>
     </section>
	</body>
</html>


<script type="text/javascript">
	var mode=null;
	var objFile=null;
	switchdiv('encrypt');

	function switchdiv(t) {
		if(t=='encrypt') {
			divEncryptfile.style.display='block';
			divDecryptfile.style.display='none';
			btnDivEncrypt.disabled=true;
			btnDivDecrypt.disabled=false;
			mode='encrypt';
		} else if(t=='decrypt') {
			divEncryptfile.style.display='none';
			divDecryptfile.style.display='block';
			btnDivEncrypt.disabled=false;
			btnDivDecrypt.disabled=true;
			mode='decrypt';
		}
	}

	function encvalidate() {
		if(txtEncpassphrase.value.length>=8 && txtEncpassphrase.value==txtEncpassphraseretype.value) { 
		  spnCheckretype.classList.add("greenspan");
		  spnCheckretype.classList.remove("redspan");
		  spnCheckretype.innerHTML='&#9989;';
		} else { 
		  spnCheckretype.classList.remove("greenspan");
		  spnCheckretype.classList.add("redspan");
  		  spnCheckretype.innerHTML='&#10060;';
		}

		if( txtEncpassphrase.value.length>=8 && txtEncpassphrase.value==txtEncpassphraseretype.value && objFile ) { btnEncrypt.disabled=false; } else { btnEncrypt.disabled=true; }
	}

	function decvalidate() {
		if( txtDecpassphrase.value.length>0 && objFile ) { btnDecrypt.disabled=false; } else { btnDecrypt.disabled=true; }
	}

	//drag and drop functions:
	//https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API/File_drag_and_drop
	function drop_handler(ev) {
		console.log("Drop");
		ev.preventDefault();
		// If dropped items aren't files, reject them
		var dt = ev.dataTransfer;
		if (dt.items) {
			// Use DataTransferItemList interface to access the file(s)
			for (var i=0; i < dt.items.length; i++) {
				if (dt.items[i].kind == "file") {
					var f = dt.items[i].getAsFile();
					console.log("... file[" + i + "].name = " + f.name);
					objFile=f;
				}
			}
		} else {
			// Use DataTransfer interface to access the file(s)
			for (var i=0; i < dt.files.length; i++) {
				console.log("... file[" + i + "].name = " + dt.files[i].name);
			}  
			objFile=file[0];
		}		 
		displayfile()
		if(mode=='encrypt') { encvalidate(); } else if(mode=='decrypt') { decvalidate(); }
	}

	function dragover_handler(ev) {
		console.log("dragOver");
		// Prevent default select and drag behavior
		ev.preventDefault();
	}

	function dragend_handler(ev) {
		console.log("dragEnd");
		// Remove all of the drag data
		var dt = ev.dataTransfer;
		if (dt.items) {
			// Use DataTransferItemList interface to remove the drag data
			for (var i = 0; i < dt.items.length; i++) {
				dt.items.remove(i);
			}
		} else {
			// Use DataTransfer interface to remove the drag data
			ev.dataTransfer.clearData();
		}
	}

	function selectfile(Files) {
		objFile=Files[0];
		displayfile()
		if(mode=='encrypt') { encvalidate(); } else if(mode=='decrypt') { decvalidate(); }
	}

	function displayfile() {
		var s;
		var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
		var bytes=objFile.size;
		var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
		if(i==0) { s=bytes + ' ' + sizes[i]; } else { s=(bytes / Math.pow(1024, i)).toFixed(2) + ' ' + sizes[i]; }

		if(mode=='encrypt') { 
			spnencfilename.textContent=objFile.name + ' (' + s + ')'; 
		} else if(mode=='decrypt') {  
			spndecfilename.textContent=objFile.name + ' (' + s + ')'; 
		} 
	}

	function readfile(file){
		return new Promise((resolve, reject) => {
			var fr = new FileReader();  
			fr.onload = () => {
				resolve(fr.result )
			};
			fr.readAsArrayBuffer(file);
		});
	}

	async function encryptfile() {
		btnEncrypt.disabled=true;

		var plaintextbytes=await readfile(objFile)
		.catch(function(err){
			console.error(err);
		});	
		var plaintextbytes=new Uint8Array(plaintextbytes);

		var pbkdf2iterations=10000;
		var passphrasebytes=new TextEncoder("utf-8").encode(txtEncpassphrase.value);
		var pbkdf2salt=window.crypto.getRandomValues(new Uint8Array(8));

		var passphrasekey=await window.crypto.subtle.importKey('raw', passphrasebytes, {name: 'PBKDF2'}, false, ['deriveBits'])
		.catch(function(err){
			console.error(err);
		});
		console.log('passphrasekey imported');

		var pbkdf2bytes=await window.crypto.subtle.deriveBits({"name": 'PBKDF2', "salt": pbkdf2salt, "iterations": pbkdf2iterations, "hash": 'SHA-256'}, passphrasekey, 384)		
		.catch(function(err){
			console.error(err);
		});
		console.log('pbkdf2bytes derived');
		pbkdf2bytes=new Uint8Array(pbkdf2bytes);

		keybytes=pbkdf2bytes.slice(0,32);
		ivbytes=pbkdf2bytes.slice(32);

		var key=await window.crypto.subtle.importKey('raw', keybytes, {name: 'AES-CBC', length: 256}, false, ['encrypt']) 
		.catch(function(err){
			console.error(err);
		});
		console.log('key imported');		

		var cipherbytes=await window.crypto.subtle.encrypt({name: "AES-CBC", iv: ivbytes}, key, plaintextbytes)
		.catch(function(err){
			console.error(err);
		});

		if(!cipherbytes) {
		 	spnEncstatus.classList.add("redspan");
			spnEncstatus.innerHTML='<p>Error encrypting file.  See console log.</p>';
			return;
		}

		console.log('plaintext encrypted');
		cipherbytes=new Uint8Array(cipherbytes);

		var resultbytes=new Uint8Array(cipherbytes.length+16)
		resultbytes.set(new TextEncoder("utf-8").encode('Salted__'));
		resultbytes.set(pbkdf2salt, 8);
		resultbytes.set(cipherbytes, 16);

		var blob=new Blob([resultbytes], {type: 'application/download'});
		var blobUrl=URL.createObjectURL(blob);
		aEncsavefile.href=blobUrl;
		aEncsavefile.download=objFile.name + '.enc';

	 	spnEncstatus.classList.add("greenspan");
		spnEncstatus.innerHTML='<p>File encrypted.</p>';
		aEncsavefile.hidden=false;
	}

	async function decryptfile() {
		btnDecrypt.disabled=true;

		var cipherbytes=await readfile(objFile)
		.catch(function(err){
			console.error(err);
		});	
		var cipherbytes=new Uint8Array(cipherbytes);

		var pbkdf2iterations=10000;
		var passphrasebytes=new TextEncoder("utf-8").encode(txtDecpassphrase.value);
		var pbkdf2salt=cipherbytes.slice(8,16);


		var passphrasekey=await window.crypto.subtle.importKey('raw', passphrasebytes, {name: 'PBKDF2'}, false, ['deriveBits'])
		.catch(function(err){
			console.error(err);

		});
		console.log('passphrasekey imported');

		var pbkdf2bytes=await window.crypto.subtle.deriveBits({"name": 'PBKDF2', "salt": pbkdf2salt, "iterations": pbkdf2iterations, "hash": 'SHA-256'}, passphrasekey, 384)		
		.catch(function(err){
			console.error(err);
		});
		console.log('pbkdf2bytes derived');
		pbkdf2bytes=new Uint8Array(pbkdf2bytes);

		keybytes=pbkdf2bytes.slice(0,32);
		ivbytes=pbkdf2bytes.slice(32);
		cipherbytes=cipherbytes.slice(16);

		var key=await window.crypto.subtle.importKey('raw', keybytes, {name: 'AES-CBC', length: 256}, false, ['decrypt']) 
		.catch(function(err){
			console.error(err);
		});
		console.log('key imported');		

		var plaintextbytes=await window.crypto.subtle.decrypt({name: "AES-CBC", iv: ivbytes}, key, cipherbytes)
		.catch(function(err){
			console.error(err);
		});

		if(!plaintextbytes) {
		 	spnDecstatus.classList.add("redspan");
			spnDecstatus.innerHTML='<p>Error decrypting file.  Password may be incorrect.</p>';
			return;
		}

		console.log('ciphertext decrypted');
		plaintextbytes=new Uint8Array(plaintextbytes);

		var blob=new Blob([plaintextbytes], {type: 'application/download'});
		var blobUrl=URL.createObjectURL(blob);
		aDecsavefile.href=blobUrl;
		aDecsavefile.download=objFile.name + '.dec';

	 	spnDecstatus.classList.add("greenspan");
		spnDecstatus.innerHTML='<p>File decrypted.</p>';
		aDecsavefile.hidden=false;
	}

</script>